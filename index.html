<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>교사 키우기 게임</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap');
    body {
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      transition: background-image 0.5s ease-in-out;
      background: #f1f6ff;
      font-family: 'Noto Sans KR', "Malgun Gothic", sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      
    }
    #game-box {
      width: 90%;
      max-width: 600px;
      margin: 20px auto;
      background: rgba(255, 255, 255, 0.9);
      border-radius: 12px;
      padding: 32px;
      box-shadow: 0 4px 25px rgba(0,0,0,0.2);
      position: relative;
      overflow: hidden;
      transition: opacity 0.5s;
    }
    #story {
        font-size: 18px;
        font-weight: 500;
        line-height: 1.7;
        margin-bottom: 24px;
        color: #333;
        white-space: pre-wrap;
    }
    .choice-btn {
      display: block;
      width: 100%;
      margin: 10px 0;
      padding: 16px;
      background: #4a69bd;
      color: white;
      border-radius: 8px;
      cursor: pointer;
      border: none;
      font-size: 16px;
      font-family: inherit;
      font-weight: 500;
      transition: background 0.2s, transform 0.1s;
    }
    .choice-btn:hover {
      background: #3b5496;
    }
    .ending-title {
        font-size: 22px;
        font-weight: 700;
        color: #4a69bd;
        margin-bottom: 15px;
    }
    .credit-item {
        opacity: 0;
        transition: opacity 1.5s;
        margin-bottom: 8px;
    }
    .ending-credits {
        margin-top: 20px;
        font-size: 16px;
        line-height: 1.8;
        text-align: center;
        overflow: hidden;
        height: 150px;
        border-top: 1px solid #eee;
        padding-top: 20px;
    }
    #modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.6);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 1000;
        opacity: 0;
        transition: opacity 0.3s;
    }
    #modal-content {
        background: #fff;
        padding: 30px 40px;
        border-radius: 12px;
        text-align: center;
        width: 80%;
        max-width: 400px;
        box-shadow: 0 5px 20px rgba(0,0,0,0.2);
        transform: scale(0.9);
        transition: transform 0.3s;
    }
    #modal-text {
        font-size: 17px;
        margin-bottom: 25px;
        line-height: 1.6;
        color: #333;
        font-weight: 500;
    }
    #modal-close-btn {
        padding: 12px 30px;
        font-size: 16px;
        background: #4a69bd;
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        transition: background 0.2s;
        font-family: inherit;
        font-weight: 500;
    }
    @media (min-width: 601px) {
      body {
        background-attachment: fixed;
      }
    }
  </style>
</head>
<body>
  <audio id="bgm-main" src="audio/bgm_main.mp3" loop></audio>
  <audio id="bgm-walk" src="audio/bgm_walk.mp3" loop></audio>
  <audio id="bgm-game" src="audio/bgm_game.mp3" loop></audio>
  <audio id="bgm-golden" src="audio/bgm_golden.mp3" loop></audio>
  <audio id="bgm-trot" src="audio/bgm_trot.mp3" loop></audio>
  <audio id="bgm-peppermint" src="audio/bgm_peppermint.mp3" loop></audio>
  <audio id="bgm-graduate" src="audio/bgm_graduate.mp3" loop></audio>
  <audio id="bgm-happy" src="audio/bgm_happy.mp3" loop></audio>
  <audio id="bgm-bad" src="audio/bgm_bad.mp3" loop></audio>
  <audio id="bgm-hidden" src="audio/bgm_hidden.mp3" loop></audio>
  <div id="game-box">
    <div id="story"></div>
    <div id="choices"></div>
  </div>

  <div id="modal-overlay">
      <div id="modal-content">
          <p id="modal-text"></p>
          <button id="modal-close-btn">확인</button>
      </div>
  </div>

  <script>
    let stats = { 교사능력치: 0, 학생친밀도: 0, 고재쌤: 0, 체력: 7 };
    let currentSceneId = 'start';
    let nextSceneCallback = null;

    const storyEl = document.getElementById("story");
    const choicesEl = document.getElementById("choices");
    const gameBox = document.getElementById("game-box");
    const modalOverlay = document.getElementById("modal-overlay");
    const modalContent = document.getElementById("modal-content");
    const modalText = document.getElementById("modal-text");
    const modalCloseBtn = document.getElementById("modal-close-btn");
  
    // --- 오디오 요소 가져오기 ---
    const bgmMain = document.getElementById('bgm-main');
    const bgmWalk = document.getElementById('bgm-walk');
    const bgmGame = document.getElementById('bgm-game');
    const bgmGolden = document.getElementById('bgm-golden');
    const bgmTrot = document.getElementById('bgm-trot');
    const bgmPeppermint = document.getElementById('bgm-peppermint');
    const bgmGraduate = document.getElementById('bgm-graduate');
    const bgmHappy = document.getElementById('bgm-happy');
    const bgmBad = document.getElementById('bgm-bad');
    const bgmHidden = document.getElementById('bgm-hidden');
    // 모든 오디오를 배열로 관리하면 편리합니다.
    const allAudios = [bgmMain, bgmWalk, bgmGame, bgmGolden, bgmTrot, bgmPeppermint, bgmGraduate, bgmHappy, bgmBad, bgmHidden];
    
    const scenarios = {
      // 시작
      'start': { bgImage: 'game/s1.jpg', text: "교사 키우기 시뮬레이터", choices: [ {text: "START", next: 's1'} ] },
      
      // 시나리오 1
      's1': { bgImage: 'game/s1.jpg', text: "시나리오 1: 새로운 반과의 첫 만남", choices: [ { text: "시작하기", next: 's1_1'} ] },
      's1_1': { bgImage: 'game/s1.jpg', text: "새로운 학기가 시작되었습니다. 학생들에게 어떤 말을 할까요?", choices: [ { text: "따뜻하게 웃으며 이름을 한 명씩 불러준다.", effect: { 학생친밀도: 1 }, feedback: "학생들과 좋은 분위기가 형성됩니다!", next: 's1_2' }, { text: "앞으로 학급에서 지켜야 할 규칙들과 지녀야 할 태도를 설명한다.", effect: { 교사능력치: 1 }, feedback: "반에 질서가 세워집니다!", next: 's1_2' }, { text: "라떼는을 시전하며 일장 연설을 한다.", effect: { 체력: -1, 학생친밀도: -1 }, feedback: "앗, 지루해하는 아이들의 표정에 상처받았습니다! 체력 -1", next: 's1_2' } ] },
      's1_2': { bgImage: 'game/s1.jpg', text: "반 아이들은 어떤 성격일까요?", choices: [ { text: "활기차고 재미있는 아이들", effect: { 학생친밀도: 1 }, feedback: "앞으로 반이 활기가 넘치겠네요!", next: 's1_3' }, { text: "공부를 잘하는 아이들", effect: { 교사능력치: 1 }, feedback: "모범생들이 가득합니다!", next: 's1_3' }, { text: "말 안 듣고 골치 아픈 아이들", effect: { 체력: -1, 교사능력치: -1 }, feedback: "앗, 반배정 운이 좋지 않았습니다! 앞으로 1년 동안 힘겨울 예정입니다... 체력 -1", next: 's1_3' } ] },
      's1_3': { bgImage: 'game/s1.jpg', text: "개학날 1교시입니다. 새로운 반과의 첫 시간을 어떻게 보낼까요?", choices: [ { text: "아이스 브레이킹 게임을 한다.", effect: { 학생친밀도: 1 }, feedback: "학생들과의 사이가 가까워집니다!", next: 's2' }, { text: "자기 소개 시간을 가진다.", effect: { 교사능력치: 1 }, feedback: "학생들을 더 잘 알게 되었습니다!", next: 's2' }, { text: "복장, 머리, 태도를 하나하나 지적하며 잔소리한다.", effect: { 체력: -1, 학생친밀도: -1 }, feedback: "앗, 아이들의 표정이 얼어붙었습니다! 첫인상이 좋진 않아 보입니다... 체력 -1", next: 's2' } ] },
      
      // 시나리오 2
      's2': { bgImage: 'game/s2.jpg', text: "시나리오 2: 학생의 고민 상담", choices: [ { text: "계속하기", next: 's2_1'} ] },
      's2_1': { bgImage: 'game/s2.jpg', text: "한 학생이 고민이 있다며 찾아왔습니다. 어떻게 반응할까요?", choices: [ { text: "'그래 무슨 일이니?' 웃으며 맞아준다.", effect: { 학생친밀도: 1 }, feedback: "쭈뼛대던 학생의 마음이 풀어집니다!", next: 's2_2' }, { text: "'그래, 함께 방법을 찾아보자.' 진지하게 대한다.", effect: { 교사능력치: 1 }, feedback: "굉장히 믿음직스럽습니다!", next: 's2_2' }, { text: "'나 지금 바쁘니까 나중에 오도록 해.' 학생을 내친다.", effect: { 체력: -1, 학생친밀도: -1, 교사능력치: -1 }, feedback: "앗, 고민이 있는 학생을 내쳐버렸습니다! 자신의 교사로서의 자격에 의구심이 듭니다... 체력 -1", next: 's3' } ] },
      's2_2': { bgImage: 'game/s2.jpg', text: "찾아 온 학생의 고민은 무엇일까요?", choices: [ { text: "성적 고민", effect: { 교사능력치: 1 }, feedback: "학생이 당신을 신뢰하고 있네요.", next: 's2_3' }, { text: "인간 관계 고민", effect: { 학생친밀도: 1 }, feedback: "학생이 당신에게 마음을 열었습니다.", next: 's2_4' }, { text: "사실 없다...", effect: { 체력: -1 }, feedback: "앗, 학생이 어그로를 끌어버렸습니다! 당신은 골치가 아파집니다... 체력 -1", next: 's3' } ] },
      's2_3': { bgImage: 'game/s2.jpg', text: "'공부를 아무리 열심히 해도 성적이 계속 떨어져요...' 당신은 어떻게 반응할까요?", choices: [ { text: "학생에게 공감하며 학생의 감정을 어루만져준다.", effect: { 학생친밀도: 1 }, feedback: "학생의 마음이 따뜻해집니다!", next: 's3' }, { text: "차분히 듣고 관련 자료를 찾아보며 실질적인 조언을 해준다.", effect: { 교사능력치: 1 }, feedback: "학생의 근심을 조금 덜어주었습니다!", next: 's3' }, { text: "네가 공부를 안 해서라며 팩폭을 한다.", effect: { 체력: -1, 학생친밀도: -1 }, feedback: "앗, 학생의 기가 죽었습니다! 그런 학생을 보고 마음이 아파집니다... 체력 -1", next: 's3' } ] },
      's2_4': { bgImage: 'game/s2.jpg', text: "'친구들 사이에서 소외되는 것 같아 외로워요...' 당신은 어떻게 반응할까요?", choices: [ { text: "학생에게 공감하며 학생의 감정을 어루만져준다.", effect: { 학생친밀도: 1 }, feedback: "학생의 마음이 따뜻해집니다!", next: 's3' }, { text: "구체적인 해결책을 찾아보며 실질적인 조언을 해준다.", effect: { 교사능력치: 1 }, feedback: "학생의 근심을 조금 덜어주었습니다!", next: 's3' }, { text: "너에게 이유가 있을 것이라며 학생을 나무란다.", effect: { 체력: -1, 학생친밀도: -1 }, feedback: "앗, 학생이 상처받았습니다! 당신은 자신의 인성에 현타가 옵니다... 체력 -1", next: 's3' } ] },

      // 시나리오 3
      's3': { bgImage: 'game/s3.jpg', text: "시나리오 3: 휴일", choices: [ { text: "계속하기", next: 's3_1'} ] },
      's3_1': { bgImage: 'game/s3.jpg', text: "오늘은 쉬는 날입니다! 오늘 하루 무엇을 하며 보낼까요?", choices: [ { text: "산책", effect: {}, feedback: "가끔은 걷는 것도 좋죠.", next: 's3_2' }, { text: "게임", effect: {}, feedback: "휴일엔 역시 게임이죠!", next: 's3_4' }, { text: "집콕", effect: { 체력: -1 }, feedback: "당신은 극E(외향형)였습니다! 밖에 나가지 못해 오히려 체력이 감소합니다... 체력 -1", next: 's3_6' } ] },
      's3_2': { bgImage: 'game/s3_1.jpg', text: "산책을 하러 집 밖에 나왔습니다. 어디로 향할까요?", choices: [ { text: "그냥 집 근처를 거닌다.", effect: {}, feedback: "당신은 귀차니즘이 발동해 멀리 가기 귀찮아져 버립니다...", next: 's3_3_1' }, { text: "남한산성으로 간다.", effect: { 고재쌤: 1 }, feedback: "남한산성의 푸르른 기운이 느껴집니다!", next: 's3_3_2' }, { text: "한강으로 간다.", effect: { 체력: -1 }, feedback: "이동 시간이 길어 피곤해집니다... 체력 -1", next: 's3_3_3' } ] },
      's3_3_1': { bgImage: 'game/s3_1.jpg', text: "산책을 하다 무언가를 마주칩니다! 무엇일까요?", choices: [ { text: "제자들", effect: { 학생친밀도: 1, 교사능력치: 1 }, feedback: "제자들을 마주칩니다! 밖에서 보니 너무 반갑네요!", next: 's4' }, { text: "강아지", effect: {}, feedback: "딱히 별 건 없고, 그냥 귀엽습니다...", next: 's4' }, { text: "예쁜 하늘", effect: {}, feedback: "감성이 충만해집니다!", next: 's4' } ] },
      's3_3_2': { bgImage: 'game/s3_2.jpg', text: "산책을 하다 무언가를 마주칩니다! 무엇일까요?", choices: [ { text: "제자들", effect: { 학생친밀도: 1, 교사능력치: 1 }, feedback: "제자들을 마주칩니다! 밖에서 보니 너무 반갑네요!", next: 's4' }, { text: "강아지", effect: {}, feedback: "딱히 별 건 없고, 그냥 귀엽습니다...", next: 's4' }, { text: "예쁜 하늘", effect: {}, feedback: "감성이 충만해집니다!", next: 's4' } ] },
      's3_3_3': { bgImage: 'game/s3_3.jpg', text: "산책을 하다 무언가를 마주칩니다! 무엇일까요?", choices: [ { text: "제자들", effect: { 학생친밀도: 1, 교사능력치: 1 }, feedback: "제자들을 마주칩니다! 밖에서 보니 너무 반갑네요!", next: 's4' }, { text: "강아지", effect: {}, feedback: "딱히 별 건 없고, 그냥 귀엽습니다...", next: 's4' }, { text: "예쁜 하늘", effect: {}, feedback: "감성이 충만해집니다!", next: 's4' } ] },
      's3_4': { bgImage: 'game/s3_4.jpg', text: "게임을 하려고 합니다! 어떤 게임을 할까요?", choices: [ { text: "리그 오브 레전드", effect: {}, feedback: "님 티어 몇?", next: 's3_5_1' }, { text: "배틀 그라운드", effect: {}, feedback: "이겼닭! 오늘 저녁은 치킨이닭!", next: 's3_5_2' }, { text: "드래곤 퀘스트", effect: { 고재쌤: 1 }, feedback: "역시 게임은 RPG!", next: 's3_5_3' } ] },
      's3_5_1': { bgImage: 'game/s3_5.jpg', text: "게임을 하던 중 학생에게 연락이 옵니다. 당신은 어떻게 할까요?", choices: [ { text: "받는다.", effect: { 학생친밀도: 1, 교사능력치: 1 }, feedback: "훌륭한 교사군요!", next: 's4' }, { text: "받지 않는다.", effect: {}, feedback: "뭐... 게임도 중요하죠!", next: 's4' }, { text: "애초에 무음이어서 듣지 못했다.", effect: {}, feedback: "게임에 진심이었군요...!", next: 's4' } ] },
      's3_5_2': { bgImage: 'game/s3_6.jpg', text: "게임을 하던 중 학생에게 연락이 옵니다. 당신은 어떻게 할까요?", choices: [ { text: "받는다.", effect: { 학생친밀도: 1, 교사능력치: 1 }, feedback: "훌륭한 교사군요!", next: 's4' }, { text: "받지 않는다.", effect: {}, feedback: "뭐... 게임도 중요하죠!", next: 's4' }, { text: "애초에 무음이어서 듣지 못했다.", effect: {}, feedback: "게임에 진심이었군요...!", next: 's4' } ] },
      's3_5_3': { bgImage: 'game/s3_7.jpg', text: "게임을 하던 중 학생에게 연락이 옵니다. 당신은 어떻게 할까요?", choices: [ { text: "받는다.", effect: { 학생친밀도: 1, 교사능력치: 1 }, feedback: "훌륭한 교사군요!", next: 's4' }, { text: "받지 않는다.", effect: {}, feedback: "뭐... 게임도 중요하죠!", next: 's4' }, { text: "애초에 무음이어서 듣지 못했다.", effect: {}, feedback: "게임에 진심이었군요...!", next: 's4' } ] },
      's3_6': { bgImage: 'game/s3_1.jpg', text: "그냥 무작정 집 밖으로 나왔습니다. 그러다 무언가를 마주칩니다! 무엇일까요?", choices: [ { text: "제자들", effect: { 학생친밀도: 1, 교사능력치: 1 }, feedback: "제자들을 마주칩니다! 밖에서 보니 너무 반갑네요!", next: 's4' }, { text: "강아지", effect: {}, feedback: "딱히 별 건 없고, 그냥 귀엽습니다...", next: 's4' }, { text: "예쁜 하늘", effect: {}, feedback: "감성이 충만해집니다!", next: 's4' } ] },
      
      // 시나리오 4
      's4': { bgImage: 'game/s4.jpg', text: "시나리오 4: 시험", choices: [ { text: "계속하기", next: 's4_1' } ] },
      's4_1': { bgImage: 'game/s4.jpg', text: "이제 시험 문제를 출제해야하는 시기가 찾아왔습니다. 어떻게 낼까요?", choices: [ { text: "이스터에그를 넣는다.", effect: { 학생친밀도: 1 }, feedback: "시험에서마저도 유쾌하군요!", next: 's4_2' }, { text: "적절한 난이도로 출제한다.", effect: { 교사능력치: 1 }, feedback: "완벽에 가까운 시험지입니다!", next: 's4_2' }, { text: "아무도 풀 수 없게 낸다.", effect: { 체력: -1 }, feedback: "당신은 시말서를 쓰게 될 것입니다... 체력 -1", next: 's4_2' } ] },
      's4_2': { bgImage: 'game/s1.jpg', text: "시험 당일입니다. 긴장한 학생들을 어떻게 풀어줄까요?", choices: [ { text: "가만히 있는다.", effect: { 교사능력치: 1 }, feedback: "오히려 좋은 선택일 수 있습니다!", next: 's4_3' }, { text: "농담으로 긴장을 풀어준다.", effect: { 학생친밀도: 1 }, feedback: "아이들의 긴장이 좀 풀어졌네요!", next: 's4_3' }, { text: "잔소리를 퍼붓는다.", effect: { 체력: -1 }, feedback: "아이들의 긴장이 더욱 증폭됩니다! 그런 분위기에 당신의 체력도 깎입니다... 체력 -1", next: 's4_3' } ] },
      's4_3': { bgImage: 'game/s2.jpg', text: "시험을 망친 한 학생이 울고 있습니다. 어떻게 위로할까요?", choices: [ { text: "아직 끝난 게 아니라고 위로한다.", effect: { 학생친밀도: 1 }, feedback: "학생의 마음이 조금 안정을 찾습니다.", next: 's5' }, { text: "시험이 어려웠으니 등급은 괜찮을 거라고 한다.", effect: { 교사능력치: 1 }, feedback: "현실적인 위로네요!", next: 's5' }, { text: "무시한다.", effect: { 체력: -1 }, feedback: "계속 들려오는 울음 소리에 집중이 되지 않습니다... 체력 -1", next: 's5' } ] },

      's5': { bgImage: 'game/s1.jpg', text: "시나리오 5: 스승의 날", choices: [ { text: "계속하기", next: 's5_1' } ] },
      's5_1': { bgImage: 'game/s5_1.jpg', text: "오늘은 스승의 날입니다. 출근하는 당신의 마음가짐은 어떤가요?", choices: [ { text: "학생들의 이벤트를 엄청나게 기대한다.", effect: { 학생친밀도: 1 }, feedback: "두근두근!", next: 's5_2' }, { text: "그저 조금 설렐 뿐, 평소와 다르지 않다.", effect: { 교사능력치: 1 }, feedback: "평정심을 유지합니다.", next: 's5_2' }, { text: "나 같은 교사에게 스승의 날은 의미가 없다.", effect: { 체력: -1 }, feedback: "앗, 당신의 자존감이 너무 낮습니다... 체력 -1", next: 's5_2' } ] },
      's5_2': { bgImage: 'game/s5_2.jpg', text: "학생들이 이벤트를 준비했습니다! 어떤 이벤트일까요?", choices: [ { text: "편지와 작은 선물", effect: { 학생친밀도: 1 }, feedback: "학생들의 진심 어린 마음에 힘이 납니다!", next: 's6' }, { text: "꽃다발과 케이크", effect: { 학생친밀도: 1 }, feedback: "화사한 꽃과 달콤한 케이크 덕분에 기분이 좋아집니다!", next: 's6' }, { text: "아무것도 준비하지 않았다.", effect: { 체력: -1 }, feedback: "당신의 설렘이 무너지며 힘이 쭉 빠집니다... 체력 -1", next: 's6' } ] },

      // 시나리오 6
      's6': { bgImage: 'game/s6.jpg', text: "시나리오 6: 체육대회", choices: [ { text: "계속하기", next: 's6_1' } ] },
      's6_1': { bgImage: 'game/s6.jpg', text: "당신도 반티를 입어달라는 아이들의 부탁, 어떻게 반응할까요?", choices: [ { text: "신나서 함께 반티의 문구를 정한다.", effect: { 학생친밀도: 1 }, feedback: "분위기는 최고조입니다! 체육대회 날이 기대되는군요!", next: 's6_2' }, { text: "튕기지만 마지못해 입기로 한다.", effect: { 교사능력치: 1 }, feedback: "싫은 척 하더니 입가에는 미소가...?", next: 's6_2' }, { text: "단호히 거절한다.", effect: { 체력: -1, 교사능력치: -1 }, feedback: "아이들이 계속 매달리며 애원합니다! 아이들을 떨쳐내느라 체력이 빠집니다... 체력 -1", next: 's6_2' } ] },
      's6_2': { bgImage: 'game/s6.jpg', text: "체육대회 당일입니다! 어떻게 즐길까요?", choices: [ { text: "반의 응원단장이 되어 열심히 응원한다.", effect: { 학생친밀도: 1 }, feedback: "열정적인 응원에 아이들도 힘이 납니다!", next: 's6_3' }, { text: "아이들이 다치지 않게 질서를 지키려 노력한다.", effect: { 교사능력치: 1 }, feedback: "덕분에 부상자 없는 체육대회를 즐길 수 있었습니다!", next: 's6_3' }, { text: "무념무상으로 있는다.", effect: { 체력: -1 }, feedback: "기가 쪼옥 빨렸습니다... 체력 -1", next: 's6_3' } ] },
      's6_3': { bgImage: 'game/s6.jpg', text: "당신의 반이 체육대회 상을 탑니다! 어떤 상일까요?", choices: [ { text: "응원상", effect: { 학생친밀도: 1 }, feedback: "열심히 즐겼다면 된 거죠!", next: 's7' }, { text: "1등상", effect: { 교사능력치: 1 }, feedback: "반 아이들이 자랑스럽습니다!", next: 's7' }, { text: "못 탔다...", effect: { 체력: -1 }, feedback: "반 아이들이 아쉬움에 몸부림칩니다... 그런 아이들의 모습에 가슴이 아픕니다... 체력 -1", next: 's7' } ] },

      // 시나리오 7
      's7': { bgImage: 'game/s3.jpg', text: "시나리오 7: 휴일2", choices: [ { text: "계속하기", next: 's7_1'} ] },
      's7_1': { bgImage: 'game/s7_1.jpg', text: "시나리오 7: 휴일2\n\n오늘은 쉬는 날입니다! 밖에 나가려 하는데, 어떤 옷을 입을까요?", choices: [ { text: "아디다스", effect: { 고재쌤: 1 }, feedback: "", next: 's7_2' }, { text: "나이키", effect: {}, feedback: "", next: 's7_2' }, { text: "정장", effect: { 체력: -1 }, feedback: "휴일에 입기에는 너무 부담스럽고 불편합니다... 체력 -1", next: 's7_2' } ] },
      's7_2': { bgImage: 'game/s7_2.jpg', text: "노래방에 왔습니다. 어떤 노래를 부를까요?", choices: [ { text: "HUNTR/X - Golden", effect: {}, feedback: "트렌드에 민감하시군요! 고음 좀 치나 본데요?", next: 's7_3_0_1' }, { text: "에픽하이 - 트로트", effect: { 고재쌤: 1 }, feedback: "역시 명곡이죠!", next: 's7_4_0_1' }, { text: "YB - 박하사탕", effect: {}, feedback: "뭘 좀 아시네요!", next: 's7_5_0_1' } ] },
      's7_3_0_1': {bgImage: 'game/karaoke.jpg', text: "We're goin' up up up\nIt's our moment", choices: [], autoNext: { duration: 4670, nextScene: 's7_3_0_2' } },
      's7_3_0_2': {bgImage: 'game/karaoke.jpg', text: "You know together we're glowing\nGonna be Gonna be golden", choices: [], autoNext: { duration: 3840, nextScene: 's7_3_0_3' } },
      's7_3_0_3': {bgImage: 'game/karaoke.jpg', text: "Oh up up up\nWith our voices", choices: [], autoNext: { duration: 4000, nextScene: 's7_3_0_4' } },
      's7_3_0_4': {bgImage: 'game/karaoke.jpg', text: "영원히 깨질 수 없는\nGonna be Gonna be golden", choices: [], autoNext: { duration: 5820, nextScene: 's7_3_1' } },
      's7_3_1': { bgImage: 'game/s7_3.jpg', text: "모란 장터손칼국수에 왔습니다! 어떤 메뉴를 먹을까요?", choices: [ { text: "바지락 칼국수", effect: {}, feedback: "먹을 줄 아시는데요?", next: 's7_3_2' }, { text: "얼큰 수제비", effect: { 고재쌤: 1 }, feedback: "맛잘알의 선택!", next: 's7_3_2' }, { text: "떡만두국", effect: {}, feedback: "먹을 줄 아시는데요?", next: 's7_3_2' } ] },
      's7_3_2': { bgImage: 'game/s7_4.jpg', text: "사색에 잠겼습니다. 당신의 인생에서 가장 중요한 것은 무엇인가요?", choices: [ { text: "사랑", effect: { 고재쌤: 1 }, feedback: "사랑을 하면 무엇이든 할 수 있지만, 사랑을 하지 않으면 어느 것도 할 수 없죠!", next: 's8' }, { text: "성공", effect: {}, feedback: "야망 있으시군요!", next: 's8' }, { text: "건강", effect: {}, feedback: "건강이 역시 최우선이죠!", next: 's8' } ] },
      's7_4_0_1': {bgImage: 'game/karaoke.jpg', text: "갈대처럼 휘고\n잡초처럼 밟힌 내 인생살이", choices: [], autoNext: { duration: 8670, nextScene: 's7_4_0_2' } },
      's7_4_0_2': {bgImage: 'game/karaoke.jpg', text: "술 한 잔에 울고\n노랫가락 속에 웃는 내 인생아", choices: [], autoNext: { duration: 9570, nextScene: 's7_4_0_3' } },
      's7_4_0_3': {bgImage: 'game/karaoke.jpg', text: "나의 트로트", choices: [], autoNext: { duration: 6000, nextScene: 's7_4_1' } },
      's7_4_1': { bgImage: 'game/s7_3.jpg', text: "모란 장터손칼국수에 왔습니다! 어떤 메뉴를 먹을까요?", choices: [ { text: "바지락 칼국수", effect: {}, feedback: "먹을 줄 아시는데요?", next: 's7_4_2' }, { text: "얼큰 수제비", effect: { 고재쌤: 1 }, feedback: "맛잘알의 선택!", next: 's7_4_2' }, { text: "떡만두국", effect: {}, feedback: "먹을 줄 아시는데요?", next: 's7_4_2' } ] },
      's7_4_2': { bgImage: 'game/s7_4.jpg', text: "사색에 잠겼습니다. 당신의 인생에서 가장 중요한 것은 무엇인가요?", choices: [ { text: "사랑", effect: { 고재쌤: 1 }, feedback: "사랑을 하면 무엇이든 할 수 있지만, 사랑을 하지 않으면 어느 것도 할 수 없죠!", next: 's8' }, { text: "성공", effect: {}, feedback: "야망 있으시군요!", next: 's8' }, { text: "건강", effect: {}, feedback: "건강이 역시 최우선이죠!", next: 's8' } ] },
      's7_5_0_1': {bgImage: 'game/karaoke.jpg', text: "열어 줘 제발\n다시 한 번만", choices: [], autoNext: { duration: 5420, nextScene: 's7_3_0_2' } },
      's7_5_0_2': {bgImage: 'game/karaoke.jpg', text: "두려움에 떨고 있어", choices: [], autoNext: { duration: 4940, nextScene: 's7_5_0_3' } },
      's7_5_0_3': {bgImage: 'game/karaoke.jpg', text: "열어 줘 제발\n다시 한 번만", choices: [], autoNext: { duration: 8260, nextScene: 's7_5_0_4' } },
      's7_5_0_4': {bgImage: 'game/karaoke.jpg', text: "단 한 번만이라도", choices: [], autoNext: { duration: 7000, nextScene: 's7_5_1' } },
      's7_5_1': { bgImage: 'game/s7_3.jpg', text: "모란 장터손칼국수에 왔습니다! 어떤 메뉴를 먹을까요?", choices: [ { text: "바지락 칼국수", effect: {}, feedback: "먹을 줄 아시는데요?", next: 's7_5_2' }, { text: "얼큰 수제비", effect: { 고재쌤: 1 }, feedback: "맛잘알의 선택!", next: 's7_5_2' }, { text: "떡만두국", effect: {}, feedback: "먹을 줄 아시는데요?", next: 's7_5_2' } ] },
      's7_5_2': { bgImage: 'game/s7_4.jpg', text: "사색에 잠겼습니다. 당신의 인생에서 가장 중요한 것은 무엇인가요?", choices: [ { text: "사랑", effect: { 고재쌤: 1 }, feedback: "사랑을 하면 무엇이든 할 수 있지만, 사랑을 하지 않으면 어느 것도 할 수 없죠!", next: 's8' }, { text: "성공", effect: {}, feedback: "야망 있으시군요!", next: 's8' }, { text: "건강", effect: {}, feedback: "건강이 역시 최우선이죠!", next: 's8' } ] },
      
      's8': { bgImage: 'game/s8.jpg', text: "시나리오 8: 졸업식", choices: [ { text: "계속하기", next: 's8_1' } ] },
      's8_1': { bgImage: 'game/s5_1.jpg', text: "벌써 졸업식 날입니다. 출근하는 당신의 기분은 어떤가요?", choices: [ { text: "긴장되고 설레면서도 아쉬운 마음이 든다.", effect: { 학생친밀도: 1 }, feedback: "학생들과 마지막이라니...", next: 's8_2' }, { text: "마지막까지 좋은 모습을 보이기 위해 책임감을 느낀다.", effect: { 교사능력치: 1 }, feedback: "마지막까지 믿음직한 교사군요!", next: 's8_2' }, { text: "이제 한동안 아이들을 안 본다니, 너무 신이 난다.", effect: { 체력: -1 }, feedback: "교사를 하지 않는 것이 좋지 않을까요...? 체력 깎습니다. 체력 -1", next: 's8_2' } ] },
      's8_2': { bgImage: 'game/s8.jpg', text: "졸업식이 진행 중입니다. 제자들에게 어떤 말을 건넬까요?", choices: [ { text: "진심 어린 축하와 격려의 말을 전한다.", effect: { 학생친밀도: 1 }, feedback: "학생들이 감동하며 당신과의 추억을 마음에 새깁니다.", next: 'ending' }, { text: "앞으로의 삶에 도움이 될 조언을 건넨다.", effect: { 교사능력치: 1 }, feedback: "현실적이지만 따뜻한 조언이 학생들의 마음에 깊이 남습니다.", next: 'ending' }, { text: "별 말 하지 않는다.", effect: { 체력: -1, 교사능력치: -1 }, feedback: "당신은 아무래도 교사가 적성에 맞지 않는 것 같습니다... 체력 -1", next: 'ending' } ] },

      // 엔딩
      'end_bad_1': { bgImage: 'game/be_1.jpg', title: "배드엔딩: 쓸쓸한 퇴사", text: "당신의 체력은 완전히 바닥났습니다. 교사라는 길이 당신과 맞지 않았던 걸까요?\n사직서를 내고 홀로 학교를 떠납니다.\n남겨진 자리는 텅 비어 있고, 아쉬워하는 사람도, 당신을 찾는 학생도 없습니다.\n그저 쓸쓸한 뒷모습만이 기억될 뿐입니다." },
      'end_bad_2': { bgImage: 'game/be_2.jpg', title: "배드엔딩: 이도저도 아닌 교사", text: "교사로서의 능력치도, 학생들과의 친밀감도 중간에 머물러 있습니다.\n어느 쪽에도 완전히 적응하지 못한 채 당신의 하루하루는 무미건조하게 흘러갑니다.\n학생들도, 동료들도, 그리고 자신조차도 만족하지 못하는 ‘이도저도 아닌 교사’로 남았습니다." },
      'end_happy_1': { bgImage: 'game/he_1.jpg', title: "해피엔딩: 사랑받는 멘토", text: "학생들의 신뢰와 사랑을 듬뿍 받은 당신.\n교실은 언제나 밝고 따뜻한 에너지로 가득합니다.\n당신은 그들의 멘토이자 친구로, 누구보다 빛나는 교사의 모습을 보여주고 있습니다." },
      'end_happy_2': { bgImage: 'game/he_2.jpg', title: "해피엔딩: 빛나는 교육자", text: "교사로서 뛰어난 전문성과 열정을 갖춘 당신.\n학생들뿐 아니라 동료 교사들 사이에서도 인정받으며 늘 성장하고 도전하는 교육자의 길을 걷고 있습니다.\n그 노력은 결코 헛되지 않았습니다." },
      'end_happy_3': { bgImage: 'game/he_3.jpg', title: "해피엔딩: 균형잡힌 스승", text: "친밀함과 전문성 모두 적절히 갖춘 당신은 학생과 교사 사이, 일과 휴식 사이 균형 잡힌 삶을 살아갑니다.\n완벽한 교사라고 할 수는 없어도, 당신이 누구에게나 사랑받는 좋은 교사임은 틀림없습니다." },
      'end_hidden': { bgImage: 'game/hide.jpg', title: "히든엔딩: 우리들의 고재샘", text: "당신은 2025년 3학년 1반의 담임이 되었습니다.\n성남여고의 아이들, 그리고 3학년 1반의 아이들에게\n당신을 만난 것은 엄청난 행운으로 생각됩니다.\n당신은 학생들에게 편하게 장난치고 웃을 수 있는 교사이자,\n고민이 있을 때 진지하게 찾아가 이야기를 나눌 수 있는 신뢰 받는 교사이기도 합니다.\n \n언제나 당신의 밝고 따뜻한 에너지가 3학년 1반 교실을 가득 채워주었습니다.\n당신은 학생들에게 공부뿐만 아니라\n세상을 바라보는 태도와,\n가끔은 하늘을 바라볼 수 있는 여유와,\n바쁜 일상 속에서 나를 한 번 더 돌아볼 수 있는 감성을 가르쳤습니다.\n \n당신은 학생들의 멘토이자 친구로서, 누구보다 빛나는 교사가 되었습니다." }
    };
  
    // --- 오디오 제어 함수 ---

    // 모든 오디오를 정지시키는 함수
    function stopAllMusic() {
        allAudios.forEach(audio => {
            audio.pause();
            audio.currentTime = 0; // 재생 위치를 처음으로 돌림
        });
    }

    // 현재 장면에 맞는 배경음악을 관리하는 함수
    function manageAudio(sceneId) {
        // 특정 시나리오 ID에 따라 음악을 분기합니다.
        switch (true) {
            // 시나리오 3 '산책' 분기 (s3_2, s3_3_x)
            // '산책'을 선택하면 s3_2로 가고, 그 후 s3_3_...으로 이어집니다.
            case sceneId.startsWith('s3_2'):
            case sceneId.startsWith('s3_3_'):
                if (bgmWalk.paused) { // 산책 BGM이 멈춰있다면
                    stopAllMusic();
                    bgmWalk.play();
                }
                break;

            // 시나리오 3 '게임' 분기 (s3_4, s3_5_x)
            // '게임'을 선택하면 s3_4로 가고, 그 후 s3_5_...으로 이어집니다.
            case sceneId.startsWith('s3_4'):
            case sceneId.startsWith('s3_5_'):
                if (bgmGame.paused) { // 게임 BGM이 멈춰있다면
                    stopAllMusic();
                    bgmGame.play();
                }
                break;
            
            // 시나리오 7 '휴일2' 분기
            case sceneId.startsWith('s7_3_'):
                if (bgmGolden.paused) {
                    stopAllMusic();
                    bgmGolden.play();
                }
                break;
            
            case sceneId.startsWith('s7_4_'):
                if (bgmTrot.paused) {
                    stopAllMusic();
                    bgmTrot.play();
                }
                break;
          
            case sceneId.startsWith('s7_5_'):
                if (bgmPeppermint.paused) {
                    stopAllMusic();
                    bgmPeppermint.play();
                }
                break;
            
            case sceneId.startsWith('s8'):
                if (bgmGraduate.paused) {
                    stopAllMusic();
                    bgmGraduate.play();
                }
                break;
            
            // 엔딩 씬일 경우 (showEnding 함수에서 별도 처리)
            case sceneId.startsWith('end_'):
                // 아무것도 하지 않음
                break;

            // 그 외 모든 일반 시나리오 (메인 BGM 재생)
            default:
                // 시나리오 3 '집콕'을 선택하면 s3_6으로 가는데,
                // 이 장면은 위 조건에 해당하지 않으므로 default로 처리됩니다.
                if (bgmMain.paused) {
                    stopAllMusic();
                    bgmMain.play();
                }
                break;
        }
    }
    
    function updateStats(effect) {
      if (!effect) return;
      for (let key in effect) {
        if (stats.hasOwnProperty(key)) {
          stats[key] += effect[key];
        }
      }
    }

    function showModal(feedback, callback) {
        if (!feedback) {
            callback();
            return;
        }
        modalText.innerText = feedback;
        modalOverlay.style.display = "flex";
        setTimeout(() => {
            modalOverlay.style.opacity = 1;
            modalContent.style.transform = 'scale(1)';
        }, 10);
        
        nextSceneCallback = callback;
    }

    modalCloseBtn.addEventListener('click', () => {
        modalOverlay.style.opacity = 0;
        modalContent.style.transform = 'scale(0.9)';
        setTimeout(() => {
            modalOverlay.style.display = "none";
            if(nextSceneCallback) nextSceneCallback();
        }, 300);
    });

    function fadeOutIn(callback) {
      gameBox.style.opacity = 0;
      setTimeout(() => {
        callback();
        gameBox.style.opacity = 1;
      }, 500);
    }

    function showScene(sceneId) {
      fadeOutIn(() => {
        if (sceneId !== 'start') {
            manageAudio(sceneId);
        }
        currentSceneId = sceneId;
        let scene = scenarios[sceneId];
        
        if (scene.bgImage) {
            document.body.style.backgroundImage = `url('${scene.bgImage}')`;
        }

        storyEl.innerText = scene.text;
        choicesEl.innerHTML = "";
        scene.choices.forEach((choice, index) => {
          const button = document.createElement('button');
          button.innerText = choice.text;
          button.className = 'choice-btn';
          button.onclick = () => chooseOption(index);
          choicesEl.appendChild(button);
        });
        
        if (scene.autoNext) {
            // 정해진 시간(duration)이 지난 후에 다음 행동을 예약
            setTimeout(() => {
                // 다음 장면으로 넘어가기 전에, 원래 스타일로 복구
                storyEl.style.fontSize = '18px';
                storyEl.style.color = '#333';
                storyEl.style.lineHeight = '1.7';
                storyEl.style.textAlign = 'left';
                document.body.style.backgroundColor = '#f1f6ff';

                // 다음 장면을 표시하기 위해 showScene 함수를 다시 호출
                showScene(scene.autoNext.nextScene);
            }, scene.autoNext.duration);
        }
      });
    }

    function chooseOption(choiceIndex) {
      if (currentSceneId === 'start') {
          bgmMain.play();
      }
      
      let choice = scenarios[currentSceneId].choices[choiceIndex];
      updateStats(choice.effect);

      if (stats.체력 <= 0) {
        showModal(choice.feedback, () => showEnding('end_bad_1'));
        return;
      }
      
      showModal(choice.feedback || "", () => {
        if (choice.next === "ending") {
          showEnding();
        } else {
          showScene(choice.next);
        }
      });
    }

    function showEnding(forcedEndingId = null) {
      stopAllMusic();
      fadeOutIn(() => {
        let endingId;
        if (forcedEndingId) {
          endingId = forcedEndingId;
        } else if (stats.고재쌤 >= 4) {
          endingId = 'end_hidden';
        } else if (stats.학생친밀도 >= 11) {
          endingId = 'end_happy_1';
        } else if (stats.교사능력치 >= 10) {
          endingId = 'end_happy_2';
        } else if (stats.교사능력치 >= 6 && stats.학생친밀도 >= 6) {
          endingId = 'end_happy_3';
        } else {
          endingId = 'end_bad_2';
        }
        
        if (endingId.includes('happy')) {
            bgmHappy.play();
        } else if (endingId.includes('bad')) {
            bgmBad.play();
        } else if (endingId.includes('hidden')) {
            bgmHidden.play();
        }

        const ending = scenarios[endingId];
        if (ending.bgImage) {
          document.body.style.backgroundImage = `url('${ending.bgImage}')`;
        }
        
        storyEl.innerHTML = '';
        choicesEl.innerHTML = '';
        
        const endingTextLines = ending.text.split('\n');
        
        const endingTitleMap = {
          'end_bad_1': '배드엔딩: 쓸쓸한 퇴사',
          'end_bad_2': '배드엔딩: 이도저도 아닌 교사',
          'end_happy_1': '해피엔딩1: 사랑받는 멘토',
          'end_happy_2': '해피엔딩2: 빛나는 교육자',
          'end_happy_3': '해피엔딩3: 균형잡힌 스승',
          'end_hidden': '히든엔딩: 우리들의 고재쌤'
        };

        function typeWriter(lines, index = 0) {
          if (index < lines.length) {
            const p = document.createElement('p');
            p.innerText = lines[index];
            p.style.opacity = 0;
            storyEl.appendChild(p);
            
            setTimeout(() => {
              p.style.transition = 'opacity 0.5s';
              p.style.opacity = 1;
            }, 100);

            setTimeout(() => typeWriter(lines, index + 1), 3000); 
          } else {
            setTimeout(() => {
              const finalTitle = document.createElement('p');
              finalTitle.innerText = `[${endingTitleMap[endingId]}]`;
              finalTitle.style.fontWeight = 'bold';
              finalTitle.style.marginTop = '20px';
              finalTitle.style.color = '#4a69bd';
              storyEl.appendChild(finalTitle);

                            // 히든 엔딩의 경우 크레딧을 순환하며 보여줍니다.
              if (endingId === 'end_hidden') {
                  const creditContainer = document.createElement('div');
                  creditContainer.className = 'ending-credits';
                  
                  // 코멘트가 표시될 단일 p 태그 생성
                  const creditP = document.createElement('p');
                  creditP.style.opacity = 0; // 처음엔 투명하게
                  creditP.style.transition = 'opacity 1.5s ease-in-out'; // 1.5초 동안 부드럽게 사라지고 나타나도록 설정
                  creditP.style.fontSize = '17px'; // 폰트 크기 살짝 키우기
                  creditP.style.fontWeight = '500'; // 폰트 두께 조절
                  
                  creditContainer.appendChild(creditP);
                  storyEl.appendChild(creditContainer);
                  
                  const credits = [
                      "\"늘 곁에 있어주셔서 감사합니다 고재쌤!\"",
                      "\"고3이라는 힘들고 어렵지만 어느 때보다 중요한 시간에\n옆에 계신 게 선생님이라 정말 힘이 돼요!\n감사합니다!\"",
                      "\"선생님 알러뷰입니다\"",
                      "\"선생님 한 학기 동안 수고 많으셨어요!\n저희 반 이끌어주시느라 힘드셨을텐데 감사합니다ㅎㅎ\n앞으로도 잘 부탁드려요!!\"",
                      "\"고재샘 우리반 포에버!!\"",
                      "\"쌤 제 입시 준비에 도움 많이 주셔서 항상 감사하게 생각하고 있고\n상담할 때 공감도 열심히 해주셔서 편안하게 쌤이랑 상담할 수 있었던 것 같아요.\n감사합니당!!\"",
                      "\"고등학교 3학년이라는 특별한 1년을 선생님과 함께해서 좋았습니다.\n감사합니다.\"",
                      "\"선생님 바보 ㅋㅋ\"",
                      "\"고3 때 친근한 쌤 만나서 부담이 준 것 같아서 좋았어요!\"",
                      "\"감사합니다아\"",
                      "\"고3 담임 하시느라 고생 많으셨어요!!\n항상 간식도 사주셔서 감사합니다\""
                  ];
                  let creditIndex = 0;

                  // 코멘트를 순환시키는 함수
                  function cycleCredits() {
                      // 1. 현재 코멘트 내용을 설정하고 서서히 나타나게 함
                      creditP.innerText = credits[creditIndex];
                      creditP.style.opacity = 1;

                      // 2. 다음 코멘트로 교체되기 전에 서서히 사라지게 함
                      // (전체 주기 시간보다 약간 일찍 사라지도록 설정)
                      const fadeOutTime = 3000; // 3초 뒤에 사라지기 시작
                      setTimeout(() => {
                          creditP.style.opacity = 0;
                      }, fadeOutTime);

                      // 3. 다음 코멘트 인덱스로 이동 (배열 끝에 도달하면 처음으로)
                      creditIndex = (creditIndex + 1) % credits.length;
                  }

                  // 4. 게임 시작 시 첫 코멘트를 즉시 보여주고,
                  // 그 후로는 5초마다 코멘트를 반복해서 교체
                  const cycleInterval = 4000; // 4초마다 반복 (이 값을 조절해 속도 변경)
                  cycleCredits(); // 첫 실행
                  setInterval(cycleCredits, cycleInterval);
              }

              // '다시 하기' 버튼 추가 (위치는 동일)
              choicesEl.innerHTML = `<button class="choice-btn" onclick="location.reload()">다시 하기</button>`;
            }, 1000);
          }
        }

        typeWriter(endingTextLines);
      });
    }

    // 게임 시작
    showScene(currentSceneId);
  </script>
</body>
</html>
